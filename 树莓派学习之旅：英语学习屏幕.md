---
title: 树莓派学习之旅：英语学习屏幕
date: 2024-07-28 18:54:05
categories: 树莓派
---

# Expectations

Use Raspberry Pi Zero W and Raspberry Pi Pico to display daily quotes from Internet. With RP Zero W always plugged, the quotes can be always displayed on OLED.

# Devices Used

- Raspberry Pi Zero W
- Raspberry Pi Pico
- OLED display module of 0.96 inch
- Jumper wires

# Packages Used

- `urllib`
- `BeautifulSoup`
- `ssd1306`
- `machine`
- `utime`

# Website for Quotes

[Hand-Picked Quotes | Simply Quotes](https://www.simplyquotes.com/quotes)

![Interface of SimplyQuotes](https://www.freeimg.cn/i/2024/07/28/66a62cd0e840d.jpeg)

Thanks for this amazing website!

# Codes

## Create the Object

```python
from urllib.request import urlopen 
from bs4 import BeautifulSoup


html = urlopen("https://www.simplyquotes.com/quotes")
bsObj = BeautifulSoup(html)
```



## Check for the rule of quotes in the website

![view-source of simplyquotes.png](https://www.freeimg.cn/i/2024/07/28/66a62cd0c5efe.png)

Search a quote we saw in the interface, so that we can find a rule of the text of the quote.

![search in view-source of simplyquotes.png](https://www.freeimg.cn/i/2024/07/28/66a62d3027504.png)

We can find the elements that contain the quotes we need look like:

```html
<div class="quote"><p>When you are grateful, fear disappears and abundance appears.</p></div>
```

So use the following lines to get the text of the quotes:

```python
quoteList = bsObj.findAll("div", {"class":"quote"}) 
for quote in quoteList:
    print(quote.get_text())
```

we get following outputs:

```
The right quote can inspire people to change their ways.
When you are grateful, fear disappears and abundance appears.
Pleasure is the only thing one should live for, nothing ages like happiness.
Aiming for perfection causes frustration at best and paralysis at worst.
The only thing an excuse gives you is an option out of the life you'd like to live.
Nine-tenths of discipline is having the patience to do things right.
The ability to play is one of the principal criteria of mental health.
Chaos is inherent in all compounded things. Strive on with diligence.
Life is about making mistakes. Death is about wishing you made more.
When you do things right, people won't be sure you've done anything at all.
There are all kinds of love in this world but never the same love twice.
It's sad, but sometimes moving on with the rest of your life, starts with goodbye.
Listen for the instruction, instead of begging for the direction.
Nothing can replace courage, a resounding motivation, and that little bit of luck.
However difficult life may seem, there is always something you can do and succeed at.
```

As we can easily find, the first element of the list is the slogan of the website, which need to be abandoned. So, use lines as follow:

```python
quoteList = bsObj.findAll("div", {"class":"quote"})[1:]
for quote in quoteList:
    print(quote.get_text())
```

Now, we can settle on the Pico.

## Connect the Wires

![Edge Image Viewer (microcontrollerslab.com)](https://microcontrollerslab.com/wp-content/uploads/2022/02/Raspberry-Pi-Pico-with-OLED-connection-diagram.jpg)

We can also use the bread board.

My devices' GND and VCC pins are different from the picture above, don't get the wires wrong!

![link of oled and pico.jpg](https://www.freeimg.cn/i/2024/07/28/66a635c7db5fb.jpg)

Pins of the Pico is attached below:

![Edge Image Viewer (theengineeringprojects.com)](https://images.theengineeringprojects.com/image/main/2021/03/what-is-raspberry-pi-pico.png)

## Operating the OLED

### Add the Package used for OLED operation

```python
# MicroPython SSD1306 OLED driver, I2C and SPI interfaces
 
from micropython import const
import framebuf
 
# register definitions
SET_CONTRAST = const(0x81)
SET_ENTIRE_ON = const(0xA4)
SET_NORM_INV = const(0xA6)
SET_DISP = const(0xAE)
SET_MEM_ADDR = const(0x20)
SET_COL_ADDR = const(0x21)
SET_PAGE_ADDR = const(0x22)
SET_DISP_START_LINE = const(0x40)
SET_SEG_REMAP = const(0xA0)
SET_MUX_RATIO = const(0xA8)
SET_IREF_SELECT = const(0xAD)
SET_COM_OUT_DIR = const(0xC0)
SET_DISP_OFFSET = const(0xD3)
SET_COM_PIN_CFG = const(0xDA)
SET_DISP_CLK_DIV = const(0xD5)
SET_PRECHARGE = const(0xD9)
SET_VCOM_DESEL = const(0xDB)
SET_CHARGE_PUMP = const(0x8D)
 
# Subclassing FrameBuffer provides support for graphics primitives
# http://docs.micropython.org/en/latest/pyboard/library/framebuf.html
class SSD1306(framebuf.FrameBuffer):
    def __init__(self, width, height, external_vcc):
        self.width = width
        self.height = height
        self.external_vcc = external_vcc
        self.pages = self.height // 8
        self.buffer = bytearray(self.pages * self.width)
        super().__init__(self.buffer, self.width, self.height, framebuf.MONO_VLSB)
        self.init_display()
 
    def init_display(self):
        for cmd in (
            SET_DISP,  # display off
            # address setting
            SET_MEM_ADDR,
            0x00,  # horizontal
            # resolution and layout
            SET_DISP_START_LINE,  # start at line 0
            SET_SEG_REMAP | 0x01,  # column addr 127 mapped to SEG0
            SET_MUX_RATIO,
            self.height - 1,
            SET_COM_OUT_DIR | 0x08,  # scan from COM[N] to COM0
            SET_DISP_OFFSET,
            0x00,
            SET_COM_PIN_CFG,
            0x02 if self.width > 2 * self.height else 0x12,
            # timing and driving scheme
            SET_DISP_CLK_DIV,
            0x80,
            SET_PRECHARGE,
            0x22 if self.external_vcc else 0xF1,
            SET_VCOM_DESEL,
            0x30,  # 0.83*Vcc
            # display
            SET_CONTRAST,
            0xFF,  # maximum
            SET_ENTIRE_ON,  # output follows RAM contents
            SET_NORM_INV,  # not inverted
            SET_IREF_SELECT,
            0x30,  # enable internal IREF during display on
            # charge pump
            SET_CHARGE_PUMP,
            0x10 if self.external_vcc else 0x14,
            SET_DISP | 0x01,  # display on
        ):  # on
            self.write_cmd(cmd)
        self.fill(0)
        self.show()
 
    def poweroff(self):
        self.write_cmd(SET_DISP)
 
    def poweron(self):
        self.write_cmd(SET_DISP | 0x01)
 
    def contrast(self, contrast):
        self.write_cmd(SET_CONTRAST)
        self.write_cmd(contrast)
 
    def invert(self, invert):
        self.write_cmd(SET_NORM_INV | (invert & 1))
 
    def rotate(self, rotate):
        self.write_cmd(SET_COM_OUT_DIR | ((rotate & 1) << 3))
        self.write_cmd(SET_SEG_REMAP | (rotate & 1))
 
    def show(self):
        x0 = 0
        x1 = self.width - 1
        if self.width != 128:
            # narrow displays use centred columns
            col_offset = (128 - self.width) // 2
            x0 += col_offset
            x1 += col_offset
        self.write_cmd(SET_COL_ADDR)
        self.write_cmd(x0)
        self.write_cmd(x1)
        self.write_cmd(SET_PAGE_ADDR)
        self.write_cmd(0)
        self.write_cmd(self.pages - 1)
        self.write_data(self.buffer)
 
class SSD1306_I2C(SSD1306):
    def __init__(self, width, height, i2c, addr=0x3C, external_vcc=False):
        self.i2c = i2c
        self.addr = addr
        self.temp = bytearray(2)
        self.write_list = [b"\x40", None]  # Co=0, D/C#=1
        super().__init__(width, height, external_vcc)
 
    def write_cmd(self, cmd):
        self.temp[0] = 0x80  # Co=1, D/C#=0
        self.temp[1] = cmd
        self.i2c.writeto(self.addr, self.temp)
 
    def write_data(self, buf):
        self.write_list[1] = buf
        self.i2c.writevto(self.addr, self.write_list)
 
 
class SSD1306_SPI(SSD1306):
    def __init__(self, width, height, spi, dc, res, cs, external_vcc=False):
        self.rate = 10 * 1024 * 1024
        dc.init(dc.OUT, value=0)
        res.init(res.OUT, value=0)
        cs.init(cs.OUT, value=1)
        self.spi = spi
        self.dc = dc
        self.res = res
        self.cs = cs
        import time
 
        self.res(1)
        time.sleep_ms(1)
        self.res(0)
        time.sleep_ms(10)
        self.res(1)
        super().__init__(width, height, external_vcc)
 
    def write_cmd(self, cmd):
        self.spi.init(baudrate=self.rate, polarity=0, phase=0)
        self.cs(1)
        self.dc(0)
        self.cs(0)
        self.spi.write(bytearray([cmd]))
        self.cs(1)
 
    def write_data(self, buf):
        self.spi.init(baudrate=self.rate, polarity=0, phase=0)
        self.cs(1)
        self.dc(1)
        self.cs(0)
        self.spi.write(buf)
        self.cs(1)

```

Copy the code above and save it as **ssd1306.py**.

### Displaying on OLED

```python
from machine import Pin, SoftI2C
from ssd1306 import SSD1306_I2C
import utime

i2c = SoftI2C(sda=Pin(0), scl=Pin(1))

# Short delay to stop I2C falling over
utime.sleep(1)

oled = SSD1306_I2C(128, 64, i2c)
led = machine.Pin(2, machine.Pin.OUT)

# Clear the screen
oled.fill(0)

oled.text("Hello OLED", 0, 0)
oled.text("--Wei Lai", 0, 16)
oled.show()
```

We can see text displayed on the OLED:

![demonstration text on oled.jpg](https://www.freeimg.cn/i/2024/07/28/66a63818dd967.jpg)

Limited by my OLED's size, at most 16 letters can be show in one row. Therefore, we need to wrap the line every 16 letters. Oh, we must keep one word at the identical line, let's not forget that.

### Splitting the Quote

First, turn the quote into independent words.

```python
quote = quoteList[0].get_text()

wordList = []
word = ""
for i in quote:
    if i != " ":
        word += i
    if i == " " or i == quote[-1]:
        wordList.append(word)
        word = ""
print(wordList)
```

```
['When', 'you', 'are', 'grateful,', 'fear', 'disappears', 'and', 'abundance', 'appears.']
```

Second, group the words in 16 letters.

```
wordGroup = []
line = ""
for i in range(len(wordList)):
    line += wordList[i]
    line += " "
    if i != len(wordList) - 1:
        if len(line + wordList[i + 1]) > 16:
            wordGroup.append(line)
            line = ""
    else:
        wordGroup.append(line[0: -1])
        line = ""

print(wordGroup)
```

```
['When you are ', 'grateful, fear ', 'disappears and ', 'abundance ', 'appears.']
```

Third, show them on the OLED.

```python
row = 0
for i in range(len(wordGroup)):
    oled.text(wordGroup[i], 0, row + i * 12)

oled.show()
```

![quote on OLED.jpg](https://www.freeimg.cn/i/2024/07/28/66a644f9a0c85.jpg)

Up to now, we've finished all the functions we need in the project.

# Integration

## Install/Copy Packages into Pico

Copying `urllib` and `BeautifulSoup` into Raspberry Pi Pico, you can refer to [Transfer files between computer and Raspberry Pi Pico • freva.com](https://www.freva.com/transfer-files-between-computer-and-raspberry-pi-pico/).

Now let's start coding!
